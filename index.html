<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>首页 - 于洋小店</title>
  <link rel="stylesheet" href="css/blog.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=LXGW+WenKai&display=swap" rel="stylesheet">
</head>
<body>
  <!-- 淘宝式：顶部窄条 -->
  <div class="tb-top-util">
    <div class="tb-wrap">
      <span class="tb-welcome">欢迎来到于洋小店</span>
      <div class="tb-util-links">
        <a href="index.html">首页</a>
        <a href="products.html">全部商品</a>
        <a href="cart.html">购物车</a>
        <a href="about.html">关于我们</a>
      </div>
    </div>
  </div>

  <!-- 淘宝式：主头部 白底 + Logo | 搜索 | 购物车 -->
  <header class="tb-header">
    <div class="tb-wrap tb-header-inner">
      <a href="index.html" class="tb-logo">于洋小店</a>
      <div class="tb-search">
        <input type="text" placeholder="搜索商品" id="topSearch" />
        <button type="button" class="tb-search-btn" onclick="location.href='products.html'">搜索</button>
      </div>
      <a href="cart.html" class="tb-cart">
        购物车
        <span class="tb-cart-badge js-cart-count">0</span>
      </a>
    </div>
  </header>

  <!-- 淘宝式：分类导航 -->
  <nav class="tb-nav">
    <div class="tb-wrap">
      <a href="index.html" class="tb-nav-item" aria-current="page">首页</a>
      <a href="products.html" class="tb-nav-item">全部商品</a>
      <a href="cart.html" class="tb-nav-item">购物车</a>
      <a href="about.html" class="tb-nav-item">关于我们</a>
    </div>
  </nav>

  <!-- 主内容：灰底 + 横幅 + 商品区 -->
  <main class="tb-main">
    <!-- 淘宝式：大横幅 -->
    <section class="tb-banner">
      <div class="tb-wrap">
        <div class="tb-banner-inner">
          <div class="tb-banner-text">
            <h2>于洋小店 · 精选好物</h2>
            <p>静候挑选，托管于 GitHub Pages</p>
            <a href="products.html" class="btn btn-primary">去选商品</a>
          </div>
          <div class="tb-banner-pic"></div>
        </div>
      </div>
    </section>

    <!-- 淘宝式：精选好物轮播 -->
    <section class="tb-content">
      <div class="tb-wrap">
        <h3 class="tb-section-title">精选好物</h3>
        <div class="tb-carousel-wrap">
          <button type="button" class="tb-carousel-btn tb-carousel-prev" id="carouselPrev" aria-label="上一组">‹</button>
          <button type="button" class="tb-carousel-btn tb-carousel-next" id="carouselNext" aria-label="下一组">›</button>
          <div class="tb-carousel" id="featuredCarousel">
            <div class="tb-carousel-inner" id="featuredProducts"></div>
          </div>
          <div class="tb-carousel-dots" id="carouselDots"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="tb-footer">
    <div class="tb-wrap">
      <p>© 2025 于洋小店 · 托管于 <a href="https://pages.github.com/">GitHub Pages</a></p>
    </div>
  </footer>

  <script src="js/products.js"></script>
  <script src="js/store.js"></script>
  <script>
    (function () {
      updateCartCount();
      var inner = document.getElementById('featuredProducts');
      var list = (window.PRODUCTS || []).slice(0, 8);
      var gap = 12;
      list.forEach(function (p) {
        var card = document.createElement('div');
        card.className = 'tb-carousel-item';
        var imgUrl = (p.image || (window.getProductImageUrl ? getProductImageUrl(p.id, 600) : '')) || '';
        var imgAlt = (p.name || '商品') + ' 图片';
        card.innerHTML =
          '<div class="tb-product-card">' +
            '<a href="product.html?id=' + p.id + '" class="tb-product-thumb">' +
              '<img src="' + imgUrl + '" alt="' + imgAlt.replace(/"/g, '&quot;') + '" loading="lazy" onerror="this.style.background=\'#e8e8e8\';this.onerror=null;" />' +
            '</a>' +
            '<div class="tb-product-body">' +
              '<a href="product.html?id=' + p.id + '" class="tb-product-name">' + p.name + '</a>' +
              '<span class="tb-product-price">¥' + p.price + '</span>' +
              '<a href="product.html?id=' + p.id + '" class="tb-product-btn">查看</a>' +
            '</div>' +
          '</div>';
        inner.appendChild(card);
      });
      var carousel = document.getElementById('featuredCarousel');
      var prevBtn = document.getElementById('carouselPrev');
      var nextBtn = document.getElementById('carouselNext');
      var dotsEl = document.getElementById('carouselDots');
      var firstItem = inner.querySelector('.tb-carousel-item');
      var itemWidth = firstItem ? firstItem.offsetWidth + gap : 212;
      var carouselWidth = carousel.offsetWidth;
      var visibleCount = Math.max(1, Math.floor(carouselWidth / itemWidth));
      var total = list.length;
      var maxIndex = Math.max(0, total - visibleCount);
      var currentIndex = 0;
      var autoTimer = null;
      function scrollTo(index) {
        currentIndex = Math.max(0, Math.min(index, maxIndex));
        carousel.scrollTo({ left: currentIndex * itemWidth, behavior: 'smooth' });
        updateDots();
      }
      function updateDots() {
        if (!dotsEl || maxIndex <= 0) return;
        dotsEl.innerHTML = '';
        for (var i = 0; i <= maxIndex; i++) {
          var dot = document.createElement('button');
          dot.type = 'button';
          dot.className = 'tb-carousel-dot' + (i === currentIndex ? ' is-active' : '');
          dot.setAttribute('aria-label', '第' + (i + 1) + '页');
          dot.addEventListener('click', function (j) { return function () { scrollTo(j); }; }(i));
          dotsEl.appendChild(dot);
        }
      }
      prevBtn.addEventListener('click', function () { scrollTo(currentIndex - 1); });
      nextBtn.addEventListener('click', function () { scrollTo(currentIndex + 1); });
      carousel.addEventListener('scroll', function () {
        var idx = Math.round(carousel.scrollLeft / itemWidth);
        if (idx !== currentIndex) { currentIndex = idx; updateDots(); }
      });
      function startAuto() {
        stopAuto();
        autoTimer = setInterval(function () {
          if (currentIndex >= maxIndex) scrollTo(0);
          else scrollTo(currentIndex + 1);
        }, 4000);
      }
      function stopAuto() {
        if (autoTimer) { clearInterval(autoTimer); autoTimer = null; }
      }
      carousel.addEventListener('mouseenter', stopAuto);
      carousel.addEventListener('mouseleave', startAuto);
      updateDots();
      startAuto();
    })();
  </script>
</body>
</html>
